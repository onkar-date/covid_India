<div class="container-fluid mt-3">
    <div class="row m-3">
        <div class="col-12 card shadow p-0">
            <div class="card-body">
                <div class="card-title">
                    <p>Find Vaccination Centers</p>
                </div>
                <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs vaccination-tabs">
                    <li [ngbNavItem]="1">
                        <a ngbNavLink>By Pincode</a>
                        <ng-template ngbNavContent>
                            <div class="border border-top-0 p-3">
                                <form [formGroup]="sessionByPinForm">
                                    <div class="form-row p-3">
                                        <div class="form-group col-md-6">
                                            <label for="pincode">
                                                Pin Code&nbsp;<span class="text-danger">*</span>
                                            </label>
                                            <input formControlName="pincode" type="number" name="pincode"
                                                class="form-control" id="pincode" aria-describedby="pincode">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="date">
                                                Date&nbsp;<span class="text-danger">*</span>
                                            </label>
                                            <input formControlName="date" type="date" class="form-control" name="date"
                                                id="date" aria-describedby="date">
                                        </div>
                                        <div class="col-12 mt-2 d-flex justify-content-center">
                                            <button type="button" class="btn btn-primary"
                                                (click)="findSessionByPin()">Find Centers</button>
                                        </div>
                                    </div>
                                </form>
                                <ng-container>

                                </ng-container>
                            </div>

                        </ng-template>
                    </li>
                    <li [ngbNavItem]="2">
                        <a ngbNavLink>By District</a>
                        <ng-template ngbNavContent>
                            <div class="border border-top-0 p-3">
                                <form class="p-3" [formGroup]="sessionByDistrictForm">
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="stateDropdown">Select state</label>
                                            <select formControlName="state" class="form-control" id="stateDropdown"
                                                (change)="getDistricts($event.target.value)">
                                                <option value="" disabled selected>-- Select State --</option>
                                                <option [value]="state.state_id" *ngFor="let state of states">
                                                    {{state.state_name}}
                                                </option>
                                            </select>
                                        </div>

                                        <div class="form-group col-md-6">
                                            <label for="stateDropdown">Select District</label>
                                            <select formControlName="district" class="form-control" id="stateDropdown"
                                                (change)="null">
                                                <option value="" disabled selected>-- Select District --</option>
                                                <option [value]="district.district_id"
                                                    *ngFor="let district of districts">
                                                    {{district.district_name}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="date">Date</label>
                                            <input formControlName="date" type="date" class="form-control" name="date"
                                                id="date" aria-describedby="date">
                                        </div>
                                        <div class="col-12 mt-2 d-flex justify-content-center">
                                            <button type="button" class="btn btn-primary"
                                                (click)="findSessionByDistrict()">Find Sessions</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </ng-template>
                    </li>
                </ul>

                <div [ngbNavOutlet]="nav" class="mt-2"></div>
            </div>
        </div>
    </div>
    <div class="row m-3">
        <div class="col-12 card shadow" *ngIf="sessions.length; else noSessions">
            <div class="card-body px-0">
                <div class="session-table">
                    <table class="covid-table table table-striped table-light">
                        <thead>
                            <th>Block</th>
                            <th>Address</th>
                            <th>Vaccine</th>
                            <th>Fee</th>
                            <th class="text-center">Min. Age</th>
                            <th class="text-center">Dose Capacity</th>
                            <th class="text-center">Dose 1</th>
                            <th class="text-center">Dose 2</th>
                            <th>Slots</th>
                        </thead>
                        <tbody>
                            <tr *ngFor="let session of sessions | slice: (page-1) * pageSize : page * pageSize">
                                <td>{{session.block_name}}</td>
                                <td>{{session.name}}</td>
                                <td>{{session.vaccine}}</td>
                                <td>
                                    <ng-container *ngIf="session.fee != 0; else free">
                                        {{session.fee}}
                                    </ng-container>
                                    <ng-template #free>
                                        <span class="text-success">Free</span>
                                    </ng-template>
                                </td>
                                <td class="text-center">{{session.min_age_limit}}</td>
                                <td class="text-center">
                                    {{session.available_capacity}}
                                </td>
                                <td class="text-center">
                                    {{session.available_capacity_dose1}}
                                </td>
                                <td class="text-center">
                                    {{session.available_capacity_dose2}}
                                </td>
                                <td>
                                    <div class="dropdown">
                                        <button class="p-0 m-0 no-style text-primary" type="button"
                                            id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                            aria-expanded="false">
                                            view slots..
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <ul>
                                                <li class="dropdown-item" *ngFor="let slot of session.slots">
                                                    {{slot}}
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="mt-3 d-flex justify-content-end">
                        <ngb-pagination [collectionSize]="sessions.length" [(page)]="page" [maxSize]="5" [rotate]="true"
                            [boundaryLinks]="true"></ngb-pagination>
                    </div>
                </div>
                <div class="container-fluid session-cards">
                    <div class="row">
                        <div class="card mb-2 border-0 col-md-4"
                            *ngFor="let session of sessions | slice: (page-1) * pageSize : page * pageSize">
                            <div class="border">
                                <div class="card-header">
                                    <h6>
                                        {{session.block_name}}
                                    </h6>
                                    <div class="text-muted small">
                                        {{session.name}}
                                    </div>
                                </div>
                                <div class="card-body">

                                    <div class="d-flex justify-content-between">
                                        <span>
                                            {{session.vaccine | titlecase}}
                                        </span>
                                        <ng-container *ngIf="session.fee != 0; else free">
                                            <span>{{session.fee | currency:'INR'}}</span>
                                        </ng-container>
                                        <ng-template #free>
                                            <span class="text-success">Free</span>
                                        </ng-template>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Min Age</span>
                                        <span>{{session.min_age_limit}}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Available Dose</span>
                                        <span>{{session.available_capacity}}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Dose 1</span>
                                        <span>{{session.available_capacity_dose1}}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Dose 2</span>
                                        <span>{{session.available_capacity_dose2}}</span>
                                    </div>
                                    <br>
                                    <h6 class="
                                    text-center mb-2">Slots</h6>
                                    <ul class="px-3 pt-0">
                                        <li *ngFor="let slot of session.slots">
                                            {{slot}}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 d-flex justify-content-end mt-2">
                            <ngb-pagination
                                [collectionSize]="sessions.length"
                                [(page)]="page" size="sm"
                                [maxSize]="3"
                                [rotate]="true"
                                [boundaryLinks]="true">
                            </ngb-pagination>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #noSessions>
    <div class="col-12 card shadow" *ngIf="formSubmitted">
        <div class="card-body px-0 text-center text-danger">
            <h6>
                No session data found..!
            </h6>
        </div>
    </div>
</ng-template>